<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>How to Extend jQuery UI's Draggable (and make it work with Isotope)</title>
    <meta name="viewport" content="width=device-width">

    <link rel="shortcut icon" href="/favicon.ico?v=3"/>
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/apple-touch-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/apple-touch-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/apple-touch-icon-152x152.png"/>

    
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="stylesheet" href="/css/main.css">

    <script type="text/javascript" src="/js/modernizr.custom.15501.js"></script>
    <script type="text/javascript" src="/js/picturefill_matchmedia.js"></script>
    <script type="text/javascript" src="//use.typekit.net/sje1dhr.js"></script>
    <script type="text/javascript">
      try {
        Typekit.load({
          active: function () {
          }
        })
      } catch (e) {
        console.log(e);
      }
    </script>
    
  </head>
  <body>
    <div id="topStripe" class="stripe"></div>

    <header class="tk-omnes-pro">
      <div class="container">

        <h1>John Starr Dewar</h1>

        <div id="pic">
        </div>
        <div id="nav">
          <a href="/about">About</a>
          <a href="/">Posts</a>
          <a href="http://www.123contactform.com/form-724791/Email-Me">Email</a>
          <a href="/follow">Follow</a>
        </div>
      </div>

    </header>

    <div id="topMargin" class="margin"></div>


    <div id="main" class="container">

      <div class="site tk-freight-sans-pro">
        <div id="home">
  <h2>How to Extend jQuery UI's Draggable (and make it work with Isotope)</h2>

  <div class="list-date">28 Oct 2011</div>
</div>

<div class="post">
  <p>First of all, here is a nice write up concerning the general concepts of
extending jQuery UI widgets using the widget factory:</p>

<p><a href="http://bililite.com/blog/extending-jquery-ui-widgets/">http://bililite.com/blog/extending-jquery-ui-widgets/</a></p>

<p>This is all well and good, but if you try to follow this approach with
Draggable you get an error message:</p>

<p><code>Uncaught TypeError: Cannot read property &#39;options&#39; of undefined</code></p>

<p>Not finding an acceptable answer online anywhere, I sat down with the debugger
and went through line by line until I found the problem.&lt;!-- more --&gt; The issue was that the
extended widget could not find the data object.  I didn&#39;t investigate too
deeply but it appears to be a side effect of the initialization process and it
didn&#39;t look easy to fix within the design of Draggable.  However, an easy
solution did suggest itself, which is to manually create the &#39;draggable&#39; data
object in your subclass, and assign the element to that data.  That makes it
available and it initializes normally when you call _create() on the
superclass.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;draggable&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span> <span class="c1">// Fixes TypeError</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="s1">&#39;_create&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Here is a discussion of the subject on the jQuery forum. I posted my solution
at the bottom:</p>

<p><a href="http://forum.jquery.com/topic/extend-draggable-widget">http://forum.jquery.com/topic/extend-draggable-widget</a></p>

<div class="divider"></div>

<p>The reason I went to all this trouble was I that I was implementing the
Isotope plugin for a project, and I wanted to be able to drag one of the items
out of the Isotope list. Because Isotope uses CSS3 transforms, and Firefox
doesn&#39;t consider the CSS3 transform when it returns element positions, the
draggable would jump unexpectedly on _mouseStart. Luckily, Isotope can
optionally store the calculated item positions in the element&#39;s data.</p>

<p>Here is the isotope site:
<a href="http://isotope.metafizzy.co/">http://isotope.metafizzy.co/</a>  Isotope is an
updated version of jQuery Masonry:
<a href="http://masonry.desandro.com/">http://masonry.desandro.com/</a>  They share a lot
of code but isotope adds more features and works much better.  In the end, I
abandoned using Isotope for this project anyway, because I needed more
detailed behavior, and extending Isotope to create what I wanted was more work
than recreating the functionality.  That said, Isotope is fairly easy to
extend.  I created a small extension without much difficulty.  So I&#39;m sure it
will come in useful at some point down the road.</p>

<p><strong>Update:</strong><br/>
You <em>do not</em> have use the following code anymore with recent Firefox versions.  If you would, however, like to see a jsFiddle with Isotope and Draggable working in concert, please take a look at this follow-up blog post:
<a href="http://jstarrdewar.com/blog/2013/02/24/an-example-using-jquery-ui-draggable-with-metafizzys-isotope-plugin/">http://jstarrdewar.com/blog/2013/02/24/an-example-using-jquery-ui-draggable-with-metafizzys-isotope-plugin/</a></p>

<p><a href="https://gist.github.com/jstarrdewar/1321760#file-jsd-draggableisotopeatom-js">Here is a gist</a> showing an extended version of jQuery UI Draggable for Firefox compatibility.</p>

</div>
<div id="share">
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="jstarrdewar" data-size="large"
     data-count="none">Tweet</a>

  <div style="float:right">
    <div class="g-plusone" data-annotation="none"></div>

  </div>
</div>


<div id="disqus_thread"></div>

<script type="text/javascript">
  var disqus_shortname = 'jstarrdewar-blog';
  var disqus_identifier = '/blog/2011/10/28/extend-jquery-draggable-to-work-with-isotope/';
  var disqus_url = 'http://jstarrdewar.com/blog/2011/10/28/extend-jquery-draggable-to-work-with-isotope/';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  (function () {
    var po = document.createElement('script');
    po.type = 'text/javascript';
    po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();
</script>

<script>!function (d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
  if (!d.getElementById(id)) {
    js = d.createElement(s);
    js.id = id;
    js.src = p + '://platform.twitter.com/widgets.js';
    fjs.parentNode.insertBefore(js, fjs);
  }
}(document, 'script', 'twitter-wjs');</script>
      </div>
    </div>
    <div id="bottomMargin" class="margin"></div>
    <div id="bottomStripe" class="stripe"></div>
    <script type="text/javascript">
      var topStripe = document.getElementById("bottomStripe");
      var topMargin = document.getElementById("bottomMargin");
      var mainContent = document.getElementById("main");
      var bottomStripe = document.getElementById("bottomStripe");
      var bottomMargin = document.getElementById("bottomMargin");

      var decorationHeight = topStripe.offsetHeight + topMargin.offsetHeight + bottomStripe.offsetHeight;
      var bottomMarginHeight = bottomMargin.offsetHeight;

      var seconds = 0;

      function checkHeight() {
        setTimeout(function () {
          var totalHeight = decorationHeight + mainContent.offsetHeight;

          if (totalHeight + bottomMarginHeight < window.innerHeight) {
            if (window.innerHeight - totalHeight < 0) {
              bottomMargin.style.height = "2rem";
            } else {
              bottomMargin.style.height = (window.innerHeight - totalHeight) + "px";

            }
          }
          if (seconds < 30) {
            seconds++;
            checkHeight();
          }
        }, 1000);
      }
      checkHeight();


    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-8569918-1']);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();

    </script>

  </body>
</html>
